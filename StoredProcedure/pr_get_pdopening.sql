DELIMITER $$

DROP PROCEDURE IF EXISTS pr_get_pdopening $$
CREATE PROCEDURE pr_get_pdopening
(
  in_from_recon_code varchar(32),
  in_to_recon_code varchar(32),
  in_to_dataset_code varchar(32)
)
me:begin
  declare v_sql text default '';

  insert into recon_trn_ttran
  (
    recon_code,
    dataset_code,
		scheduler_gid,
		tran_date,
		tran_value,
		tran_acc_mode,
		tran_mult,
		excp_value,
		mapped_value,
		roundoff_value,
		col1,
		col2,
		col3,
		col4,
		col5,
		col6,
		col7,
		col8,
		col9,
		col10,
		col11,
		col12,
		col13,
		col14,
		col15,
		col16,
		col17,
		col18,
		col19,
		col20,
		col21,
		col22,
		col23,
		col24,
		col25,
		col26,
		col27,
		col28,
		col29,
		col30,
		col31,
		col32,
		col33,
		col34,
		col35,
		col36,
		col37,
		col38,
		col39,
		col40,
		col41,
		col42,
		col43,
		col44,
		col45,
		col46,
		col47,
		col48,
		col49,
		col50,
		col51,
		col52,
		col53,
		col54,
		col55,
		col56,
		col57,
		col58,
		col59,
		col60,
		col61,
		col62,
		col63,
		col64,
		col65,
		col66,
		col67,
		col68,
		col69,
		col70,
		col71,
		col72,
		col73,
		col74,
		col75,
		col76,
		col77,
		col78,
		col79,
		col80,
		col81,
		col82,
		col83,
		col84,
		col85,
		col86,
		col87,
		col88,
		col89,
		col90,
		col91,
		col92,
		col93,
		col94,
		col95,
		col96,
		col97,
		col98,
		col99,
		col100,
		col101,
		col102,
		col103,
		col104,
		col105,
		col106,
		col107,
		col108,
		col109,
		col110,
		col111,
		col112,
		col113,
		col114,
		col115,
		col116,
		col117,
		col118,
		col119,
		col120,
		col121,
		col122,
		col123,
		col124,
		col125,
		col126,
		col127,
		col128,
		tran_remark1,
		tran_remark2,
		ko_gid,
		ko_date,
		tran_value_type,
		value_debit,
		value_credit,
		value_signed,
		value_reverse_signed,
		value_unsigned,
		value_acc_mode,
		bal_value_type,
		bal_value_debit,
		bal_value_credit,
		bal_value_signed,
		bal_value_reverse_signed,
		bal_value_unsigned,
		bal_acc_mode,
		bal_value,
		bal_mult,
		tranbrkp_dataset_code,
		theme_code
  )
  select
    in_to_recon_code,
    in_to_dataset_code,
		scheduler_gid,
		tran_date,
		excp_value,
		tran_acc_mode,
		tran_mult,
		excp_value,
		mapped_value,
		roundoff_value,
		col1,
		col2,
		col3,
		col4,
		col5,
		col6,
		col7,
		col8,
		col9,
		col10,
		col11,
		col12,
		col13,
		col14,
		col15,
		col16,
		col17,
		col18,
		col19,
		col20,
		col21,
		col22,
		col23,
		col24,
		col25,
		col26,
		col27,
		col28,
		col29,
		col30,
		col31,
		col32,
		col33,
		col34,
		col35,
		col36,
		col37,
		col38,
		col39,
		col40,
		col41,
		col42,
		col43,
		col44,
		col45,
		col46,
		col47,
		col48,
		col49,
		col50,
		col51,
		col52,
		col53,
		col54,
		col55,
		col56,
		col57,
		col58,
		col59,
		col60,
		col61,
		col62,
		col63,
		col64,
		col65,
		col66,
		col67,
		col68,
		col69,
		col70,
		col71,
		col72,
		col73,
		col74,
		col75,
		col76,
		col77,
		col78,
		col79,
		col80,
		col81,
		col82,
		col83,
		col84,
		col85,
		col86,
		col87,
		col88,
		col89,
		col90,
		col91,
		col92,
		col93,
		col94,
		col95,
		col96,
		col97,
		col98,
		col99,
		col100,
		col101,
		col102,
		col103,
		col104,
		col105,
		col106,
		col107,
		col108,
		col109,
		col110,
		col111,
		col112,
		col113,
		col114,
		col115,
		col116,
		col117,
		col118,
		col119,
		col120,
		col121,
		col122,
		col123,
		col124,
		col125,
		col126,
		col127,
		col128,
		tran_remark1,
		tran_remark2,
		ko_gid,
		ko_date,
		tran_value_type,
		value_debit,
		value_credit,
		value_signed,
		value_reverse_signed,
		value_unsigned,
		value_acc_mode,
		bal_value_type,
		bal_value_debit,
		bal_value_credit,
		bal_value_signed,
		bal_value_reverse_signed,
		bal_value_unsigned,
		bal_acc_mode,
		bal_value,
		bal_mult,
		tranbrkp_dataset_code,
		theme_code
  from recon_trn_ttran
  where recon_code = in_from_recon_code
  and mapped_value = 0
  and delete_flag = 'N';

  -- Sales Invoice
  update recon_trn_ttran set col13 = 'HIS_SETTLEMENT'
  where recon_code = in_to_recon_code
  and col1 = 'Sales Invoices'
  and col13 is null
  and delete_flag = 'N';

  -- Credit Memos
  update recon_trn_ttran set col13 = 'Credit Memos'
  where recon_code = in_to_recon_code
  and col1 = 'Credit Memos'
  and col13 is null
  and delete_flag = 'N';

  -- Debit Memos
  update recon_trn_ttran set col13 = 'Debit Memos'
  where recon_code = in_to_recon_code
  and col1 = 'Debit Memos'
  and col13 is null
  and delete_flag = 'N';

  -- tranbrkp
  insert into recon_trn_ttran
  (
		scheduler_gid,
		recon_code,
		dataset_code,
		tran_date,
		tran_value,
		excp_value,
		roundoff_value,
		tran_acc_mode,
		tran_mult,
		col1,
		col2,
		col3,
		col4,
		col5,
		col6,
		col7,
		col8,
		col9,
		col10,
		col11,
		col12,
		col13,
		col14,
		col15,
		col16,
		col17,
		col18,
		col19,
		col20,
		col21,
		col22,
		col23,
		col24,
		col25,
		col26,
		col27,
		col28,
		col29,
		col30,
		col31,
		col32,
		col33,
		col34,
		col35,
		col36,
		col37,
		col38,
		col39,
		col40,
		col41,
		col42,
		col43,
		col44,
		col45,
		col46,
		col47,
		col48,
		col49,
		col50,
		col51,
		col52,
		col53,
		col54,
		col55,
		col56,
		col57,
		col58,
		col59,
		col60,
		col61,
		col62,
		col63,
		col64,
		col65,
		col66,
		col67,
		col68,
		col69,
		col70,
		col71,
		col72,
		col73,
		col74,
		col75,
		col76,
		col77,
		col78,
		col79,
		col80,
		col81,
		col82,
		col83,
		col84,
		col85,
		col86,
		col87,
		col88,
		col89,
		col90,
		col91,
		col92,
		col93,
		col94,
		col95,
		col96,
		col97,
		col98,
		col99,
		col100,
		col101,
		col102,
		col103,
		col104,
		col105,
		col106,
		col107,
		col108,
		col109,
		col110,
		col111,
		col112,
		col113,
		col114,
		col115,
		col116,
		col117,
		col118,
		col119,
		col120,
		col121,
		col122,
		col123,
		col124,
		col125,
		col126,
		col127,
		col128,
		tran_remark1,
		tran_remark2,
		tran_value_type,
		value_debit,
		value_credit,
		value_signed,
		value_reverse_signed,
		value_unsigned,
		value_acc_mode,
		theme_code
  )
  select
		scheduler_gid,
		in_to_recon_code,
		in_to_dataset_code,
		tran_date,
		tran_value,
		excp_value,
		roundoff_value,
		tran_acc_mode,
		tran_mult,
		col1,
		col2,
		col3,
		col4,
		col5,
		col6,
		col7,
		col8,
		col9,
		col10,
		col11,
		col12,
		'HIS_COLLECTION',
		col14,
		col15,
		col16,
		col17,
		col18,
		col19,
		col20,
		col21,
		col22,
		col23,
		col24,
		col25,
		col26,
		col27,
		col28,
		col29,
		col30,
		col31,
		col32,
		col33,
		col34,
		col35,
		col36,
		col37,
		col38,
		col39,
		col40,
		col41,
		col42,
		col43,
		col44,
		col45,
		col46,
		col47,
		col48,
		col49,
		col50,
		col51,
		col52,
		col53,
		col54,
		col55,
		col56,
		col57,
		col58,
		col59,
		col60,
		col61,
		col62,
		col63,
		col64,
		col65,
		col66,
		col67,
		col68,
		col69,
		col70,
		col71,
		col72,
		col73,
		col74,
		col75,
		col76,
		col77,
		col78,
		col79,
		col80,
		col81,
		col82,
		col83,
		col84,
		col85,
		col86,
		col87,
		col88,
		col89,
		col90,
		col91,
		col92,
		col93,
		col94,
		col95,
		col96,
		col97,
		col98,
		col99,
		col100,
		col101,
		col102,
		col103,
		col104,
		col105,
		col106,
		col107,
		col108,
		col109,
		col110,
		col111,
		col112,
		col113,
		col114,
		col115,
		col116,
		col117,
		col118,
		col119,
		col120,
		col121,
		col122,
		col123,
		col124,
		col125,
		col126,
		col127,
		col128,
		tran_remark1,
		tran_remark2,
		tran_value_type,
		value_debit,
		value_credit,
		value_signed,
		value_reverse_signed,
		value_unsigned,
		value_acc_mode,
		theme_code
  from recon_trn_ttranbrkp
  where recon_code = in_from_recon_code
  and tran_gid > 0
  and delete_flag = 'N';

  -- Legacy Reference Update, Theme Blank
  -- col32 - Line Ref No
  -- col33 - Theme Ref No
  -- col34 - Entry Pass Flag
  -- col36 - Entry Ref No
  -- col49 - Legacy Line Ref No
  -- col50 - Legacy Theme Ref No
  -- col51 - Legacy Entry Ref No
  -- tran_remark2 - Theme

  update recon_trn_ttran set
	  col49 = col32,
	  col50 = col33,
	  col51 = col36,
    tran_remark2 = ''
  where recon_code = in_to_recon_code
  and delete_flag = 'N';

  -- Clear Fields
  -- col32 - Line Ref No
  -- col33 - Theme Ref No
  -- col34 - Entry Pass Flag
  -- col36 - Entry Ref No

  update recon_trn_ttran set
	  col32 = '',
	  col33 = '',
    col34 = '',
	  col36 = ''
  where recon_code = in_to_recon_code
  and delete_flag = 'N';
end $$

DELIMITER ;